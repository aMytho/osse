{
	frankenphp
	auto_https disable_redirects
	admin off
}

# The domain name of your server
{$OSSE_URL_SERVER} {
	root * public/dist/osse-web/browser/
	encode zstd br gzip
	try_files {path} /index.html
	file_server
  header Set-Cookie "API_URL={$OSSE_URL_API}; Path=/; Max-Age=31536000; SameSite=Strict; Secure;"

  tls certs/server-cert.pem certs/server-key.pem {
    client_auth {
        trust_pool file certs/ca.crt
    }
  }
}

# Serve the laravel API
{$OSSE_URL_API} {
	# Set the webroot to the public/ directory
	root * public/
	# Enable compression
	encode zstd br gzip
	# Execute PHP files from the public/ directory and serve assets
	php_server {
		try_files {path} index.php
	}

  tls certs/server-cert.pem certs/server-key.pem {
    client_auth {
        trust_pool file certs/ca.crt
    }
  }
}


# Serve osse broadcast
{$OSSE_BROADCAST_HOST} {
  reverse_proxy http://localhost:{$OSSE_BROADCAST_INTERNAL_PORT}

  tls certs/server-cert.pem certs/server-key.pem {
    client_auth {
        trust_pool file certs/ca.crt
    }
  }
}

